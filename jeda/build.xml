<?xml version="1.0" encoding="UTF-8"?>
<project name="jeda" default="default" basedir=".">
    <description>Builds, tests, and runs the project jeda.</description>
    <import file="nbproject/build-impl.xml"/>

    <!-- Properties -->

    <property name="jeda.core.dir" value="../core"/>
    <property name="jeda.nbjeda.dir" value="../nbjeda/plugin"/>
    <property name="jeda.library.release.dir" value="${jeda.nbjeda.dir}/release"/>
    <property name="jeda.source.jar" value="${jeda.library.release.dir}/sources/jeda-src.jar"/>
    <property name="jeda.javadoc.zip" value="${jeda.library.release.dir}/docs/jeda-api.zip"/>

    <target name="-post-jar">
        <!-- Load jeda version -->
        <property file="${jeda.core.dir}/src/ch/jeda/jeda.properties"/>

        <!-- Add core library to jar -->
        <jar update="true" jarfile="${dist.jar}">
            <zipfileset src="${jeda.core.dir}/dist/core.jar"/>
        </jar>

        <!-- Add information to library manifest -->
        <jar update="true" destfile="${dist.jar}">
            <manifest>
                <attribute name="Implementation-Title" value="Jeda Library"/>
                <attribute name="Implementation-URL" value="http://jeda.ch/"/>
                <attribute name="Implementation-Version" value="${jeda.version}"/>
            </manifest>
        </jar>

        <!-- BEGIN Update Jeda Library in NBJeda -->
        <copy file="${dist.jar}" tofile="${jeda.library.release.dir}/lib/jeda.jar"/>
        <zip basedir="${jeda.core.dir}/dist/javadoc" destfile="${jeda.javadoc.zip}"/>

        <zip basedir="${jeda.core.dir}/src" destfile="${jeda.source.jar}"/>
        <zip basedir="${src.dir}" update="true" destfile="${jeda.source.jar}"/>
        <!-- END Update Jeda Library in NBJeda -->

        <!-- BEGIN Update Jeda version in nbjeda -->
        <manifest file="${jeda.nbjeda.dir}/manifest.mf" mode="update">
            <attribute name="OpenIDE-Module-Specification-Version" value="${jeda.version}"/>
        </manifest>
        <!-- END Update Jeda version in nbjeda -->

        <!-- Directly update installed library files -->
        <copy file="${dist.jar}" tofile="${user.home}/.netbeans/7.3/lib/jeda.jar"/>
        <copy file="${jeda.library.release.dir}/docs/jeda-api.zip" tofile="${user.home}/.netbeans/7.3/docs/jeda-api.zip/"/>
        <copy file="${jeda.source.jar}" tofile="${user.home}/.netbeans/7.3/sources/jeda-src.jar/"/>
    </target>
</project>
